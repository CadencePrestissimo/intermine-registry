<!DOCTYPE html>
<html>
<%- include('header.ejs') %>
<body>
	<%- include('navbar.ejs') %>

    <section id="addinstance-body" class = 'pt-50'>
    	<div class="container pt-20">
    		<div class="row mt-xs-20 mt-md-20 mt-lg-20 pb-50">
    			<div class="col-lg-10 col-lg-offset-1">
            <div class="row">
              <div class="container">
                <div>
                  <a type="button" href="/" class="btn btn-default">
                    <span class="glyphicon glyphicon-home"></span> Home
                  </a>
                </div>
                <h2 class='align-center mb-50' id="action-title"> Add Instance </h2>
                <% if (typeof message !== 'undefined') { %>
                  <div class="warningalert">
                    <span class="closebtn" onclick="this.parentElement.style.display='none';">&times;</span>
                    <strong>Warning!</strong> <%= message %>
                  </div>
                <% } %>
          				<div class="main-login main-center">
          				<h5>Please, enter the instance information. Name and URL are required. If instance is a development mine, please check the Dev Mine checkbox.</h5>


          					<form class="" method="post" action="">


          						<div class="form-group">
                        <div class="row">
          							  <label for="name" class="col-md-4 control-label">Name</label>
                          <label for="email" class="col-md-6 control-label">URL</label>
                        </div>
                        <div class="row">
            							<div class="col-md-4">
            								<div class="input-group">
            									<span class="input-group-addon"><i class="glyphicon glyphicon-pencil" aria-hidden="true"></i></span>
            									<input required type="text" class="form-control" name="newName" id="newName" placeholder="Instance Name"/>
            								</div>
            							</div>
                          <div class="col-md-6">
            								<div class="input-group">
            									<span class="input-group-addon"><i class="glyphicon glyphicon-cloud" aria-hidden="true"></i></span>
            									<input type="url" class="form-control" name="newUrl" id="newUrl"  placeholder="Instance URL"/>
            								</div>
            							</div>
													<div class="col-md-2">
														<div class="checkbox">
														  <label><input type="checkbox" name="newIsDev" id="newIsDev" value="1">Dev Mine</label>
														</div>
													</div>
                        </div>
          						</div>
                      <div class="form-group">
            						<div class="row">
            							<label for="username" class="col-md-12 control-label">Description</label>
            							<div class="col-md-12">
            								<div class="input-group">
            									<span class="input-group-addon"><i class="glyphicon glyphicon-align-justify" aria-hidden="true"></i></span>
            									<textarea rows="6" type="text" class="form-control" name="newDesc" id="newDesc"  placeholder="Instance Description"> </textarea>
            								</div>
            							</div>
            						</div>
                      </div>

          						<div class="form-group">
                        <div class="row">
            							<label for="newTwitter" class="col-md-5 control-label">Twitter</label>
                        </div>
                        <div class="row">
                          <div class="col-md-5">
            								<div class="input-group">
            									<span class="input-group-addon"><i class="glyphicon glyphicon-heart" aria-hidden="true"></i></span>
            									<input type="text" class="form-control" name="newTwitter" id="newTwitter"  placeholder="Instance Twitter Account"/>
            								</div>
            							</div>
                        </div>
          						</div>

          						<div class="form-group">

          							<div class="row">
                          <label for="location" class="col-md-12 control-label">Location</label>
                        </div>
                        <div class="row">
                          <div class="col-md-5">
                            <div class="input-group">
                              <span class="input-group-addon"><i class="glyphicon glyphicon-map-marker" aria-hidden="true"></i></span>
                              <input type="number" step="0.00000001" class="form-control" name="newLatitude" id="newLatitude"  placeholder="Instance Location Latitude"/>
                            </div>
                          </div>
                        </div>
                        <div class="row mt-10">
                          <div class="col-md-5">
                            <div class="input-group">
                              <span class="input-group-addon"><i class="glyphicon glyphicon-map-marker" aria-hidden="true"></i></span>
                              <input type="number" step="0.00000001" class="form-control" name="newLongitude" id="newLongitude"  placeholder="Instance Location Longitude"/>
                            </div>
                          </div>
                        </div>

          							</div>

                        <div class="form-group">
                          <div class="row">
              							<label for="newTwitter" class="col-md-12 control-label">Organisms</label>
                          </div>
                          <div class="row">
                            <div class="col-md-12">
              								<div class="input-group">
              									<span class="input-group-addon"><i class="glyphicon glyphicon-list-alt" aria-hidden="true"></i></span>
              									<input type="text" class="form-control" name="newOrganisms" id="newOrganisms"  placeholder="Comma separated list of Organisms"/>
              								</div>
              							</div>
                          </div>
            						</div>

                        <div class="form-group">
                          <div class="row">
              							<label for="newTwitter" class="col-md-12 control-label">Neighbours</label>
                          </div>
                          <div class="row">
                            <div class="col-md-12">
              								<div class="input-group">
              									<span class="input-group-addon"><i class="glyphicon glyphicon-list-alt" aria-hidden="true"></i></span>
              									<input type="text" class="form-control" name="newNeighbours" id="newNeighbours"  placeholder="Comma separated list of Neighbours"/>
              								</div>
              							</div>
                          </div>
            						</div>

          						<div class="form-group" id="submit-form">
                        <input id="form-action-type" type="hidden" name="_method" value="post" />
                        <input id="form-instance-id" type="hidden" name="updateId" value="" />
          							<input type="submit" value="Save" id="submit-button" class="btn btn-primary btn-lg btn-block login-button" />
          						</div>

          					</form>
                    </div>
          				</div>
          			</div>
            </div>
          </div>
        </div>
      </div>
    </section>

    </script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script type="text/javascript">
      var jQuery_2_1_3 = $.noConflict(true);
    </script>
    <script language="javascript" src="/javascripts/header.js"></script>
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

    <script language="javascript" src="/js/bootstrap.min.js"></script>

    <% if (typeof message !== 'undefined') { %>
      <script type="text/javascript">
        $("#newName").val("<%= name %>");
        $("#newUrl").val("<%= url %>");
        $("#newDesc").val("<%= desc %>");
        $("#newTwitter").val("<%= twitter %>");
        $("#newLatitude").val(<%= lat %> );
        $("#newLongitude").val(<%= lon %> );
        $("#newOrganisms").val("<%= organisms %>");
        $("#newNeighbours").val("<%= neighbours %>");
      </script>
    <% } %>

    <script type="text/javascript">
      $.urlParam = function(name){
      	var results = new RegExp('[\?&]' + name + '=([^&#]*)').exec(window.location.href);
      	return results[1] || 0;
      }
      var instanceToEdit = $.urlParam('update');
      $.get("../service/instances/" + instanceToEdit, function(response){

        var instance = response.instance;

        $("#form-action-type").attr('value', 'put');
        $("#form-instance-id").attr('value', instance.id)

        $("#action-title").text("Update " + instance.name);
        $("#newName").val(instance.name);
        $("#newUrl").val(instance.url);
        $("#newDesc").val(instance.description);
        $("#newTwitter").val(instance.twitter);
        $("#newLatitude").val(instance.location.latitude);
        $("#newLongitude").val(instance.location.longitude);
        $("#newOrganisms").val(instance.organisms.join());
        $("#newNeighbours").val(instance.neighbours.join());
      });
    </script>



  </body>
</html>
